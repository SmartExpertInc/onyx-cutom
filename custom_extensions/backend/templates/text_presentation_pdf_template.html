<!DOCTYPE html>
<html lang="{{ details.detectedLanguage if details and details.detectedLanguage else 'ru' }}">
<head>
    <meta charset="UTF-8">
    <title>{{ details.textTitle if details and details.textTitle else 'Text Presentation' }}</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        html {
          box-sizing: border-box;
          -webkit-print-color-adjust: exact;
          print-color-adjust: exact;
        }
        *, *:before, *:after {
          box-sizing: inherit;
        }

        :root {
            --font-primary: 'Inter', Arial, sans-serif;
            --font-emoji: 'Noto Color Emoji', 'Noto Emoji', 'Segoe UI Emoji', 'Apple Color Emoji', 'Android Emoji', 'Twemoji Mozilla', 'Symbola', 'EmojiOne Color', 'EmojiSymbols', 'Segoe UI Symbol', sans-serif;
            --color-primary-accent: #FF1414;
            --color-primary-accent-dark: #CC1010;
            --color-primary-accent-light-bg: #fafafa;
            --color-blue-primary: #0F58F9;
            --color-text-black: #000000;
            --color-text-darkest: #171718; /* Updated to match React component */
            --color-text-default: #000000; 
            --color-text-muted: #000000;  
            --color-border-extralight: #F3F4F6;
            --color-border-light: #E5E7EB; 
            --color-background-page: #FFFFFF;

            --font-weight-normal: 400;
            --font-weight-medium: 500;
            --font-weight-semibold: 600;
            --font-weight-bold: 700;

            --font-size-paragraph-small: 14px;
            --font-size-list-item: 16px; 
            --font-size-base: 16px;
            --line-height-base: 1.5; 

            --font-size-main-title: 30px; 
            --font-size-h1-content: 17px;  
            --font-size-other-section-header: 18px; 

            --font-size-h3-box: 17px;
            --font-size-h4-box: 16px;
            --font-size-p-box: 14px;

            --font-size-mini-title: 12px;
            --font-size-mini-title-text: 11px;
            
            --list-number-circle-size: 24px;
            --list-number-font-size: 15px;

            --space-xxs: 2px; --space-xs: 4px; --space-sm: 8px; --space-md: 12px;
            --space-lg: 18px; --space-xl: 24px; --space-2xl: 32px; --space-3xl: 48px;
            --content-max-width-constrained: 100%;
            
            /* Dynamic spacing variables for page optimization */
            --dynamic-spacing-multiplier: 1;
            --dynamic-font-size-multiplier: 1;
            
            --color-alert-text: #4B5563;
            --letter-spacing-increased: 0; 
        }

        @page { margin-top: 0mm; margin-bottom: 0mm; margin-left: 5mm; margin-right: 5mm; size: A4; }
        @page :first { margin-top: 0mm; }
        /* Removed non-standard @page :not(:first) rule to satisfy linter while keeping consistent margins */
        body {
            font-family: var(--font-primary); margin: 0; padding: 0;
            background-color: var(--color-background-page); color: #4B5563;
            font-size: var(--font-size-base); font-weight: 300;
            line-height: var(--line-height-base); widows: 3; orphans: 3;
            letter-spacing: normal;
        }
        
        /* Ensure emoji characters are properly rendered */
        * {
            font-family: var(--font-primary) !important;
        }
        
        .pdf-container { 
            width: 100%; 
            padding: 16px; 
            background-color: #F2F2F4; 
            min-height: 100vh; 
        }
        .content-wrapper { 
            max-width: 64rem; /* match frontend max-w-5xl */
            margin: 24px auto;
            background-color: white; 
            border: 2px solid #CCCCCC;
            border-radius: 10px; 
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            overflow: hidden; 
        }
        
        /* Dynamic spacing classes for page optimization */
        .content-wrapper.spacing-compact { --dynamic-spacing-multiplier: 0.8; --dynamic-font-size-multiplier: 0.95; }
        .content-wrapper.spacing-normal { --dynamic-spacing-multiplier: 1; --dynamic-font-size-multiplier: 1; }
        .content-wrapper.spacing-expanded { --dynamic-spacing-multiplier: 1.3; --dynamic-font-size-multiplier: 1.05; }
        .content-wrapper.spacing-very-expanded { --dynamic-spacing-multiplier: 1.6; --dynamic-font-size-multiplier: 1.1; }
        .grey-section {
            background-color: #FFFFFF; 
            border-radius: 10px; 
            padding: 16px 32px; 
            margin: 0 auto; 
            max-width: 100%; 
            page-break-inside: avoid;
        }
        /* --- Mini-section (important) box: blue left border --- */
        .mini-section-box-wrapper {
            margin-top: var(--space-xl);
            margin-bottom: var(--space-xl);
            page-break-inside: avoid;
        }
        .mini-section-box {
            background-color: #fff !important;
            border-left: 3px solid #0F58F9; /* Updated to match React component */
            padding: 12px; /* p-3 */
            border-radius: 0;
            text-align: left;
        }
        .mini-section-box > .content-block-wrapper:first-child { margin-top: 0 !important; }
        .mini-section-box > .content-block-wrapper:first-child > .headline-block { margin-top: 0 !important; }
        .mini-section-box > .content-block-wrapper:last-child { margin-bottom: 0 !important; }
        .mini-section-box > .content-block-wrapper:last-child > .list-block-wrapper { margin-bottom: 0 !important; }
        .mini-section-box .content-block-wrapper, .mini-section-box .paragraph-block { max-width: 100%; }
        .mini-section-box .list-block-wrapper { max-width: 100%; }
        .mini-section-box .list-block-wrapper li { font-size: var(--font-size-list-item); }
        .mini-section-box .list-marker { margin-right: 8px; }
        .mini-section-box .list-marker .icon-svg { 
            width: 1.25em; 
            height: 1.25em; 
            vertical-align: middle;
            display: inline-block;
        }
        
        /* Default bullet dots should be blue in mini-sections */
        .mini-section-box .list-marker .icon-svg.icon-new-bullet {
            color: #0F58F9;
            fill: #0F58F9;
            margin-right: 0;
        }
        
        /* Custom icons should be red in mini-sections */
        .mini-section-box .list-marker .icon-svg:not(.icon-new-bullet) {
            color: #FF1414; /* text-[#FF1414] */
            fill: #FF1414;
        }
        .mini-section-box .list-block-wrapper > ul,
        .mini-section-box .list-block-wrapper > ol { margin-bottom: 0 !important; }
        .mini-section-box .paragraph-block:last-child { margin-bottom: 0 !important; }

        .main-title-section { 
            background-color: white;
            text-align: left;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
            border-bottom: 1px solid #CCCCCC;
            margin-bottom: 0;
        }
        .main-title-text {
            font-family: var(--font-primary);
            font-size: 24px; /* text-2xl */
            font-weight: 700; /* font-bold */
            color: #0F58F9; /* text-[#0F58F9] */
            margin: 0 0 8px 0; 
            line-height: 1.2;
            text-align: left;
            padding: 16px 40px; /* py-4 px-10 */
        }
        .icon-svg { display: inline-block; vertical-align: middle; width: 1em; height: 1em; flex-shrink: 0; }
        .icon-svg.icon-new-bullet { fill: currentColor; stroke: none; }

                .content-block-wrapper { 
            margin-bottom: calc(var(--space-sm) * var(--dynamic-spacing-multiplier)); 
            text-align: left; 
        }
        .content-block-wrapper:last-child { margin-bottom: 0; }

        .headline-block { 
            font-family: var(--font-primary);
            display: flex; align-items: center; line-height: 1.5; max-width: 100%; text-align: left; 
        }
        .headline-block .icon-svg { 
            margin-right: 6px; width: 1.0em; height: 1.0em; 
            flex-shrink: 0; color: #FF1414; /* text-[#FF1414] */
        }
        .headline-block span { flex-grow: 1; text-align: left; }
        /* H1: text-xl font-bold text-[#171718] (normal) or !text-[#0F58F9] (recommendation) */
        .headline-block.h1 { 
            font-size: 1.25rem; /* text-xl = 20px = 1.25rem */
            font-weight: 700; /* font-bold */
            color: #171718; /* text-[#171718] */
            margin-top: 0; 
            margin-bottom: 0.5rem; 
            text-align: left; 
            line-height: 1.3;
        }
        /* H2: text-xl font-semibold text-[#171718] (normal) or !text-[#0F58F9] (recommendation) */
        .headline-block.h2 { 
            font-size: 1.25rem; /* text-xl = 20px = 1.25rem */
            font-weight: 600; /* font-semibold */
            color: #171718; /* text-[#171718] */
            line-height: 1.3; 
            margin-top: 1.25rem; 
            margin-bottom: 0.75rem; 
            text-align: left; 
        }
        /* H3: text-lg font-medium !text-[#0F58F9] (always blue) */
        .headline-block.h3 { 
            font-size: 1.125rem; /* text-lg = 18px = 1.125rem */
            font-weight: 500; /* font-medium */
            color: #0F58F9 !important; /* !text-[#0F58F9] */
            margin-top: 0.625rem; 
            margin-bottom: 0.375rem; 
            text-align: left; 
            line-height: 1.3;
        }
        /* H4: text-base font-bold !text-[#0F58F9] (always blue) */
        .headline-block.h4 { 
            font-size: 1rem; /* text-base = 16px = 1rem */
            font-weight: 700; /* font-bold */
            color: #0F58F9 !important; /* !text-[#0F58F9] */
            margin-top: 0.625rem; 
            margin-bottom: 0.375rem; 
            text-align: left; 
            line-height: 1.3;
        }
        
        .paragraph-block { 
            font-family: var(--font-primary); 
            font-size: 1rem; /* text-base = 16px = 1rem */
            line-height: 1.5; /* leading-normal */
            font-weight: 300; /* font-light */
            margin-bottom: 1rem; 
            color: #4B5563; /* text-gray-600 */
            text-align: left; 
            width: 100%; 
        }

        .list-block-wrapper ul, .list-block-wrapper ol { 
            padding-left: 0; 
            list-style-type: none; 
            margin-top: 4px; 
            margin-bottom: 12px; 
            max-width: 100%; 
            text-align: left; 
            /* Single column layout - space-y-1.5 */
            display: flex;
            flex-direction: column;
            gap: 6px; /* space-y-1.5 equivalent */
        }
        .list-block-wrapper li { 
            margin-bottom: 0; /* Remove individual margins since we use gap */
            font-family: var(--font-primary);
            font-size: 16px; /* Match paragraph size */
            font-weight: 300; /* font-light to match paragraphs */
            line-height: 1.6; 
            color: #4B5563; /* text-gray-600 */
            display: flex; 
            align-items: flex-start;
        }
        
        /* General spacing for all bullet list markers */
        .list-block-wrapper ul > li > .list-marker {
            margin-right: 8px;
            flex-shrink: 0;
        }
        
        /* General icon styling for all bullet lists */
        .list-block-wrapper ul > li > .list-marker .icon-svg {
            width: 1.25em;  
            height: 1.25em; 
            fill: currentColor; 
            stroke: none; 
            display: block; 
            vertical-align: middle;
        }
        
        /* Default bullet dots should be blue */
        .list-block-wrapper ul > li > .list-marker .icon-svg.icon-new-bullet {
            color: #0F58F9;
            fill: #0F58F9;
        }
        
        /* Custom icons should be red */
        .list-block-wrapper ul > li > .list-marker .icon-svg:not(.icon-new-bullet) {
            color: #FF1414; /* text-[#FF1414] */
            fill: #FF1414;
        }
        
        .content-wrapper > .content-block-wrapper.type-bullet_list ul > li:not(:last-child) { margin-bottom: 2px; }
        
        /* Reduce spacing for default bullet icons */
        .content-wrapper > .content-block-wrapper.type-bullet_list ul > li > .list-marker .icon-svg.icon-new-bullet {
            margin-right: 0;
        }
        
        /* Ensure the list-marker itself has more spacing for custom icons - simplified without :has() for compatibility */
        .content-wrapper > .content-block-wrapper.type-bullet_list ul > li > .list-marker {
            margin-right: 12px;
        }
        .list-item-content-wrapper ul > li > .list-marker .icon-svg { 
            width: 0.6em; 
            height: 0.6em;
            color: var(--color-text-muted); 
        }
        .list-item-text-or-block { flex-grow: 1; }

        .content-wrapper > .content-block-wrapper.type-numbered_list > .list-block-wrapper > ol { list-style-type: none; margin: 0; padding: 0; }
        .content-wrapper > .content-block-wrapper.type-numbered_list > .list-block-wrapper > ol > li { display: flex; align-items: center; gap: 16px; }
        .content-wrapper > .content-block-wrapper.type-numbered_list > .list-block-wrapper > ol > li:not(:last-child) { margin-bottom: var(--space-sm); }
        .list-number-circle {
            flex-shrink: 0;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background-color: #FF1414; /* Keep red background for numbered lists */
            color: #fff;
            font-size: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 8px;
        }
        .content-wrapper > .content-block-wrapper.type-numbered_list ol > li::before { display: none; content: ""; }
        .content-wrapper > .content-block-wrapper.type-numbered_list ol > li > .list-marker { display: none; }
        .content-wrapper > .content-block-wrapper.type-numbered_list ol > li .list-content-column .list-item-text-or-block > .content-block-wrapper.type-bullet_list { margin-bottom: 0; }
        .content-wrapper > .content-block-wrapper.type-numbered_list ol > li .list-content-column .list-block-wrapper.type-bullet_list > ul { margin: 0; padding: 0; list-style: none; }
        .content-wrapper > .content-block-wrapper.type-numbered_list ol > li .list-content-column .list-block-wrapper.type-bullet_list > ul > li { padding: 0; margin: 0 0 var(--space-xs) 0; display: flex; align-items: center; } 
        .content-wrapper > .content-block-wrapper.type-numbered_list ol > li .list-content-column .list-block-wrapper.type-bullet_list > ul > li:last-child { margin-bottom: 0; }
        .content-wrapper > .content-block-wrapper.type-numbered_list ol > li .list-content-column .list-block-wrapper.type-bullet_list > ul > li > .list-marker { display: flex; }

        .content-wrapper > .content-block-wrapper.type-numbered_list ol > li .list-content-column > .content-block-wrapper:first-child > .headline-block {
            margin-top: 0;
        }
        
        .content-wrapper > .content-block-wrapper.type-numbered_list ol > li .list-content-column .list-block-wrapper.type-bullet_list .headline-block { margin-top: -3px !important; margin-bottom: var(--space-xs) !important; font-size: var(--font-size-mini-title); font-weight: var(--font-weight-bold); color: var(--color-text-black); line-height: 1.5; text-transform: uppercase; letter-spacing: var(--letter-spacing-increased); }
        .content-wrapper > .content-block-wrapper.type-numbered_list ol > li .list-content-column .list-block-wrapper.type-bullet_list .headline-block .icon-svg { display: none; }
        .content-wrapper > .content-block-wrapper.type-numbered_list ol > li .list-content-column .list-block-wrapper.type-bullet_list .paragraph-block { font-size: var(--font-size-mini-title-text); font-weight: var(--font-weight-normal); color: var(--color-text-muted); max-width: 100%; line-height: 1.5; letter-spacing: var(--letter-spacing-increased); }

        .alert-block { display: flex; padding: var(--space-md); border-left: 4px solid; border-radius: 6px; margin-bottom: var(--space-md); font-size: var(--font-size-paragraph-small); page-break-inside: avoid; color: var(--color-alert-text) !important; line-height: 1.5; letter-spacing: var(--letter-spacing-increased); font-family: var(--font-primary); background-color: #F8FAFF; }
        .alert-block .icon-container { margin-right: var(--space-sm); flex-shrink: 0; padding-top: 0.1em; }
        .alert-block .icon-container .icon-svg { width: 2.4em; height: 2.4em; display: block; }
        .alert-block .text-container { flex-grow: 1; }
        .alert-block .alert-title { font-family: var(--font-primary); font-weight: var(--font-weight-semibold); margin-bottom: var(--space-xs); font-size: 11pt; color: #171718; } 
        .alert-block .alert-text { font-family: var(--font-primary); font-size: 8pt; color: #4B5563; }
        .alert-block.alert-info { background-color: #eff6ff; border-color: #3b82f6; }
        .alert-block.alert-info .icon-container { color: #3b82f6; }
        .alert-block.alert-success { background-color: #f0fdf4; border-color: #22c55e; }
        .alert-block.alert-success .icon-container { color: #22c55e; }
        .alert-block.alert-warning { background-color: #fefce8; border-color: #eab308; }
        .alert-block.alert-warning .icon-container { color: #eab308; }
        .alert-block.alert-danger { background-color: #fef2f2; border-color: #ef4444; }
        .alert-block.alert-danger .icon-container { color: #ef4444; }
        .purple-card-icon-wrapper {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #0F58F9;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: #FFFFFF;
            flex-shrink: 0;
        }
        .purple-card-icon-wrapper .icon-svg {
            width: 22px;
            height: 22px;
            color: #FFFFFF;
            stroke: currentColor;
            fill: currentColor;
        }

        .paragraph-block.recommendation {
            font-size: 16px;
            color: #4B5563;
            margin-top: var(--space-sm);
            margin-bottom: var(--space-sm);
            font-weight: 300;
            padding: 12px 16px;
            border-left: 4px solid #0F58F9;
            background-color: rgba(15, 88, 249, 0.08);
            border-radius: 8px;
            line-height: 1.6;
            letter-spacing: 0;
        }
        
        li .paragraph-block.recommendation {
            margin-top: 0;
            margin-bottom: var(--space-xs);
        }

        .list-block-wrapper.has-recommendation {
            border-left: none;
            padding-left: 0;
        }
        .section-break-block.solid, .section-break-block.dashed { border: none; border-top: 0.5pt solid var(--color-border-light); margin: var(--space-xl) 0; } 
        .section-break-block.none { height: var(--space-lg); border:none; }
        .content-section-divider { border: none; border-top: 0.5pt solid var(--color-border-light); margin: var(--space-md) 0 var(--space-xs) 0; max-width: 100%; }

        .content-wrapper > .content-block-wrapper.type-paragraph { max-width: var(--content-max-width-constrained); }
        .content-wrapper > .content-block-wrapper.type-alert { max-width: var(--content-max-width-constrained); }
        .list-block-wrapper .content-block-wrapper.type-paragraph { max-width: 100%; }

        .headline-block, .alert-block, li, .paragraph-block { page-break-inside: avoid; }
        .headline-block.h2 { page-break-before: auto; page-break-after: avoid; }
        hr.content-section-divider { page-break-before: auto; page-break-after: avoid;}
        
        /* Prevent page breaks within individual blocks only */
        .content-block-wrapper { page-break-inside: avoid; }
        .list-block-wrapper { page-break-inside: avoid; }
        .mini-section-box-wrapper { page-break-inside: avoid; }
        .mini-section-box { page-break-inside: avoid; }
        
        /* Allow page breaks for tables and numbered lists */
        .content-block-wrapper.type-table { page-break-inside: auto; }
        .content-block-wrapper.type-numbered_list { page-break-inside: auto; }
        .content-block-wrapper.type-numbered_list .list-block-wrapper { page-break-inside: auto; }
        .content-block-wrapper.type-numbered_list ol { page-break-inside: auto; }
        .content-block-wrapper.type-numbered_list li { page-break-inside: auto; }
        
        /* Increase spacing before headlines */
        .content-block-wrapper.type-headline { margin-top: 24px; }
        .content-block-wrapper.type-headline:first-child { margin-top: 0; }
        .content-wrapper > .content-block-wrapper.type-headline:first-child { margin-top: 0; }
        
        /* Increase spacing between end of section and next headline by 30% */
        .content-block-wrapper:not(.type-headline) + .content-block-wrapper.type-headline { 
            margin-top: calc(24px * 1.3); /* 30% increase from 24px */
        }
        
        /* Increase spacing after mini-section-box (important sections) to next headline by 30% */
        .mini-section-box-wrapper + .content-block-wrapper.type-headline { 
            margin-top: calc(24px * 1.3); /* 30% increase from 24px */
        }
        
        /* Increase spacing after content-block-wrapper to next headline by 30% */
        .content-block-wrapper:not(.type-headline):last-child + .content-block-wrapper.type-headline { 
            margin-top: calc(24px * 1.3); /* 30% increase from 24px */
        }
    </style>
</head>
<body>
    <svg width="0" height="0" style="position:absolute;display:none;" aria-hidden="true">
        <defs>
            <symbol id="icon-new-bullet" viewBox="0 0 6 6">
                <circle cx="3" cy="3" r="0.75" fill="currentColor"/>
            </symbol>
            
            <!-- New Icon Set -->
            <symbol id="icon-info" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10" />
                <path d="M12 16v-4" />
                <path d="M12 8h.01" />
            </symbol>
            <symbol id="icon-goal" viewBox="-1 -1 18 18" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="16" height="16" rx="8" fill="#FF1414"/><path fill-rule="evenodd" clip-rule="evenodd" d="M7.66681 3.66672C5.08942 3.66672 3 5.75606 3 8.33336C3 10.9107 5.08942 13 7.66681 13C10.2442 13 12.3336 10.9107 12.3336 8.33336C12.3336 7.70679 12.2098 7.10913 11.9858 6.56324L11.9441 6.6049C11.8353 6.71373 11.6922 6.78166 11.5391 6.79694L11.0311 6.84761C11.232 7.30193 11.3438 7.80451 11.3438 8.33325C11.3438 10.364 9.69753 12.0101 7.66681 12.0101C5.63599 12.0101 3.9898 10.3639 3.9898 8.33325C3.9898 6.30261 5.6361 4.65637 7.66681 4.65637C8.19535 4.65637 8.69784 4.76817 9.15206 4.96889L9.20263 4.46137C9.21791 4.30813 9.28617 4.1649 9.39489 4.05607L9.43656 4.01441C8.89076 3.79049 8.2933 3.66672 7.66681 3.66672ZM9.36818 6.16003L9.53428 4.49445C9.5422 4.41772 9.5765 4.34627 9.63058 4.29175L10.8249 3.09753C10.9172 3.00574 11.0538 2.97551 11.1757 3.02069C11.2977 3.06576 11.3832 3.17766 11.393 3.30715L11.4873 4.51237L12.6933 4.60713C12.822 4.61735 12.9342 4.70188 12.9793 4.82401C13.0245 4.94602 12.9941 5.08321 12.9027 5.175L11.7085 6.36922C11.6544 6.42385 11.5827 6.4576 11.506 6.4653L9.84 6.63139L7.90272 8.56893C7.83786 8.63389 7.75234 8.66665 7.66681 8.66665C7.58129 8.66665 7.49576 8.63389 7.4309 8.56893C7.30119 8.43878 7.30119 8.22772 7.4309 8.09746L9.36818 6.16003ZM7.66681 6.99997C7.78609 6.99997 7.90173 7.01569 8.01177 7.04515L7.19522 7.86178C6.93524 8.12175 6.93534 8.54398 7.19489 8.80428C7.3201 8.92981 7.48961 8.99994 7.66681 8.99994C7.84391 8.99994 8.0132 8.92981 8.13841 8.80461L8.95485 7.98798C8.98431 8.09812 9.00014 8.21387 9.00014 8.33336C9.00014 9.06975 8.40323 9.66664 7.66681 9.66664C6.9304 9.66664 6.33348 9.06975 6.33348 8.33336C6.33348 7.59697 6.9304 6.99997 7.66681 6.99997ZM7.66681 5.32296C8.1782 5.32296 8.6598 5.45069 9.08149 5.6756L9.04829 6.00845L8.52865 6.52806C8.26768 6.40319 7.97538 6.33328 7.6667 6.33328C6.56214 6.33328 5.66666 7.22872 5.66666 8.33325C5.66666 9.43777 6.56214 10.3332 7.6667 10.3332C8.77127 10.3332 9.66675 9.43777 9.66675 8.33325C9.66675 8.02447 9.59672 7.73207 9.47174 7.47089L9.99148 6.95105L10.3241 6.91786C10.5494 7.33975 10.6771 7.82144 10.6771 8.33303C10.6771 9.99553 9.32927 11.3433 7.6667 11.3433C6.00414 11.3433 4.6563 9.99553 4.6563 8.33303C4.6563 6.67053 6.00425 5.32296 7.66681 5.32296Z" fill="white"/></symbol>
            <symbol id="icon-star" viewBox="-1 -1 18 18" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="16" height="16" rx="8" fill="#FF1414"/><path d="M7.68389 3.24065C7.78339 2.91978 8.21661 2.91978 8.31611 3.24065L9.26859 6.31234C9.31309 6.45584 9.4407 6.553 9.5847 6.553H12.667C12.989 6.553 13.1228 6.98473 12.8624 7.18304L10.3687 9.08144C10.2522 9.17013 10.2035 9.32733 10.248 9.47083L11.2005 12.5425C11.3 12.8634 10.9495 13.1302 10.689 12.9319L8.19536 11.0335C8.07887 10.9448 7.92113 10.9448 7.80464 11.0335L5.31101 12.9319C5.05052 13.1302 4.70004 12.8634 4.79954 12.5425L5.75202 9.47083C5.79651 9.32733 5.74777 9.17013 5.63127 9.08144L3.13765 7.18304C2.87716 6.98473 3.01103 6.553 3.33301 6.553H6.41531C6.5593 6.553 6.68692 6.45584 6.73141 6.31234L7.68389 3.24065Z" fill="white"/></symbol>
            <symbol id="icon-apple" viewBox="0 0 24 24" fill="currentColor"><path d="M12 20.94c1.5 0 2.75 1.06 4 1.06 3 0 6-8 6-12.22A4.91 4.91 0 0 0 17 5c-2.22 0-4 1.44-5 2-1-.56-2.78-2-5-2a4.9 4.9 0 0 0-5 4.78C2 14 5 22 8 22c1.25 0 2.5-1.06 4-1.06Z"/><path d="M10 2c1 .5 2 2 2 5"/></symbol>
            <symbol id="icon-award" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path d="m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526"/><circle cx="12" cy="8" r="6"/></symbol>
            <symbol id="icon-boxes" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path d="M2.97 12.92A2 2 0 0 0 2 14.63v3.24a2 2 0 0 0 .97 1.71l3 1.8a2 2 0 0 0 2.06 0L12 19v-5.5l-5-3-4.03 2.42Z"/><path d="m7 16.5-4.74-2.85"/><path d="m7 16.5 5-3"/><path d="M7 16.5v5.17"/><path d="M12 13.5V19l3.97 2.38a2 2 0 0 0 2.06 0l3-1.8a2 2 0 0 0 .97-1.71v-3.24a2 2 0 0 0-.97-1.71L17 10.5l-5 3Z"/><path d="m17 16.5-5-3"/><path d="m17 16.5 4.74-2.85"/><path d="M17 16.5v5.17"/><path d="M7.97 4.42A2 2 0 0 0 7 6.13v4.37l5 3 5-3V6.13a2 2 0 0 0-.97-1.71l-3-1.8a2 2 0 0 0-2.06 0l-3 1.8Z"/><path d="M12 8 7.26 5.15"/><path d="m12 8 4.74-2.85"/><path d="M12 13.5V8"/></symbol>
            <symbol id="icon-calendar" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path d="M11 14h1v4"/><path d="M16 2v4"/><path d="M3 10h18"/><path d="M8 2v4"/><rect x="3" y="4" width="18" height="18" rx="2"/></symbol>
            <symbol id="icon-chart" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"/><line x1="7" y1="13" x2="7" y2="21"/><line x1="12" y1="9" x2="12" y2="21"/><line x1="17" y1="5" x2="17" y2="21"/></symbol>
            <symbol id="icon-clock" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></symbol>
            <symbol id="icon-globe" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"/><path d="M2 12h20"/></symbol>
            <symbol id="icon-boxes" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2l9 5-9 5-9-5 9-5z"/><path d="M3 7v10l9 5 9-5V7"/><path d="M12 12v10"/></symbol>
            <symbol id="icon-info" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12" y2="8"/></symbol>
            <symbol id="icon-goal" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/><line x1="12" y1="2" x2="12" y2="6"/><line x1="12" y1="18" x2="12" y2="22"/><line x1="2" y1="12" x2="6" y2="12"/><line x1="18" y1="12" x2="22" y2="12"/></symbol>
            <symbol id="icon-star" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 14.9 8.62 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 9.1 8.62 12 2"/></symbol>
            <symbol id="icon-apple" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path d="M16 13c-1.13 3.7-.43 7.2 1 9-4 .67-8-1.33-10-5-2-3.65-1.19-8.52 2-10 1.18-.63 3 .5 4 0 .83-.38 1.5-2.27 1-4 2.67.67 4 4 2 6 2 .5 3 3 0 4Z"/><path d="M12 7s-1-1-2-1-2 .5-2 .5"/></symbol>
            <symbol id="icon-award" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="8" r="6"/><path d="M9 14l-3 7 6-3 6 3-3-7"/></symbol>
            <symbol id="icon-calendar" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></symbol>
            <symbol id="icon-drilling" viewBox="0 0 38 38" fill="currentColor"><path d="M15.6315 6.92906H22.3646C23.6174 6.92906 24.6387 5.90782 24.6387 4.64904V3.5625C24.6387 2.90935 24.1043 2.375 23.4512 2.375H14.5449C13.8918 2.375 13.3574 2.90935 13.3574 3.5625V4.64904C13.3574 5.90782 14.3786 6.92906 15.6315 6.92906Z"/><path d="M18.9988 29.1841C19.1531 29.1841 19.3016 29.1247 19.4203 29.0059L21.825 26.6013C21.9378 26.4944 21.9972 26.34 21.9972 26.1856V25.7344L17.3125 27.7413L18.5772 29.0059C18.6959 29.1247 18.8444 29.1841 18.9988 29.1841Z"/><path d="M16.002 8.11719V11.8756L15.5091 12.0834C15.2063 12.2141 15.0698 12.5644 15.1945 12.8672C15.3319 13.1743 15.7048 13.3135 16.002 13.1641L22.0048 10.605L22.4916 10.3972C23.2186 10.068 22.7236 8.98124 22.0047 9.31659C22.0048 9.31657 22.0048 8.11719 22.0048 8.11719H16.002Z"/><path d="M22.8052 14.2319C22.6785 13.921 22.3068 13.7779 22.0037 13.9291V11.8984C19.7415 12.818 16.5389 14.3141 16.0009 14.3863C16.0009 14.3863 16.0009 16.4763 16.0009 16.4763L15.5021 16.69C14.7774 17.0265 15.2782 18.1042 16.0009 17.7706C16.0009 17.7706 22.0037 15.2175 22.0037 15.2175L22.4906 15.0097C22.7934 14.885 22.9359 14.5347 22.8052 14.2319Z"/><path d="M22.806 18.8472C22.6771 18.5317 22.3056 18.3965 21.9985 18.5444L22.0044 16.5078L16.4647 18.865C16.3163 18.9303 16.1619 18.9778 16.0016 18.9956V21.0915L15.5029 21.3053C15.206 21.43 15.0635 21.7803 15.1941 22.0831C15.3265 22.4012 15.7007 22.5293 16.0016 22.3859C16.0016 22.386 21.9985 19.8328 21.9985 19.8328L22.4913 19.625C22.7941 19.4944 22.9366 19.15 22.806 18.8472Z"/><path d="M22.4895 24.2383C23.2167 23.907 22.7339 22.8259 21.9966 23.1517L21.9966 21.1211C19.8318 22.0204 16.391 23.5734 15.9998 23.6149L15.9998 25.7108L15.5545 25.9008C14.9618 26.1419 15.1566 27.052 15.7861 27.0408C15.9377 27.0576 16.2607 26.8825 16.4035 26.833L21.9966 24.4461L22.4895 24.2383Z"/><path d="M13.6543 14.8438C13.6543 14.5172 13.3871 14.25 13.0605 14.25H2.9668C2.64024 14.25 2.37305 14.5172 2.37305 14.8438V17.8125H13.6543V14.8438Z"/><path d="M4.19587 23.7916C4.55413 24.0002 5.42014 24.0001 5.77522 23.7915C6.04836 23.6847 6.3868 23.5481 7.01024 23.5481C8.08021 23.5346 8.11102 23.9306 9.02899 23.9519C9.93919 23.9296 9.97634 23.5341 11.0418 23.5482C12.1217 23.5345 12.1395 23.9308 13.0605 23.9519C13.0606 23.9519 13.6543 23.9519 13.6543 23.9519V19H2.37305V23.5481C2.99299 23.5137 3.83458 23.5907 4.19587 23.7916Z"/><path d="M15.2218 29.3063C14.1062 28.2068 13.5778 26.6901 13.6543 25.1382C13.0357 25.1726 12.1918 25.0955 11.8315 24.8947C11.4779 24.6871 10.6149 24.6851 10.2581 24.8948C9.98493 25.0016 9.64648 25.1382 9.029 25.1382C7.95384 25.1527 7.92784 24.7575 7.01024 24.7344C6.08863 24.7563 6.06338 25.1521 4.98555 25.1381C3.91648 25.1517 3.88407 24.7557 2.96681 24.7344C2.9668 24.7344 2.37305 24.7344 2.37305 24.7344V29.6863H15.6433C15.4949 29.5676 15.3584 29.4428 15.2218 29.3063Z"/><path d="M35.0293 14.25H24.9355C24.609 14.25 24.3418 14.5172 24.3418 14.8438V17.8125H35.623V14.8438C35.623 14.5172 35.3559 14.25 35.0293 14.25Z"/><path d="M24.3418 23.5481H24.9355C26.0032 23.5346 26.0406 23.9309 26.9543 23.9519C27.8748 23.9299 27.902 23.5342 28.979 23.5481C29.5965 23.5481 29.9349 23.6847 30.208 23.7916C30.5617 23.9991 31.4245 24.0011 31.7815 23.7915C32.0546 23.6847 32.393 23.5481 33.0105 23.5481C33.634 23.5481 33.9724 23.6847 34.2396 23.7916C34.5375 23.9715 35.2111 23.9602 35.6231 23.9518L35.623 19H24.3418V23.5481Z"/><path d="M33.8012 24.8947C33.4476 24.6871 32.5846 24.6851 32.2277 24.8948C31.9546 25.0016 31.6162 25.1382 30.9987 25.1382C29.9233 25.1526 29.8977 24.7575 28.9799 24.7344C28.0586 24.7563 28.0328 25.1521 26.9552 25.1381C25.8859 25.1517 25.8539 24.7557 24.9365 24.7344C24.9365 24.7344 24.3427 24.7344 24.3427 24.7344C24.4898 26.6531 23.8234 28.5456 22.3477 29.6863C22.3477 29.6863 35.624 29.6863 35.624 29.6863V25.1382C35.0034 25.1725 34.1629 25.0957 33.8012 24.8947ZM27.5371 28.196C26.7572 28.1852 26.7565 27.0231 27.5371 27.0085C28.3178 27.0232 28.3169 28.1853 27.5371 28.196ZM30.874 27.6022C30.094 27.5914 30.0933 26.4294 30.874 26.4147C31.6547 26.4295 31.6538 27.5915 30.874 27.6022Z"/><path d="M2.37305 35.0312C2.37305 35.3578 2.64024 35.625 2.9668 35.625H35.0293C35.3559 35.625 35.6231 35.3578 35.6231 35.0312V30.875H2.37305V35.0312Z"/></symbol>
            <symbol id="icon-sawing" viewBox="0 0 34 30" fill="currentColor"><path d="M8.98869 0.936214C7.7403 -0.312104 5.70909 -0.312039 4.46077 0.936214L0.939119 4.45793C-0.309133 5.70625 -0.309133 7.73747 0.939119 8.98585L5.7164 13.7631L13.766 5.7135L8.98869 0.936214ZM5.46704 7.97958L3.95773 6.47027L6.47318 3.95483L7.98248 5.46413L5.46704 7.97958Z"/><path d="M33.4429 25.6133H0.00292969V29.8822H33.4429V25.6133Z"/><path d="M15.2743 7.42188L9.1875 13.5087L10.0213 17.3441L13.8784 18.1828L14.7169 22.0398L18.6397 22.8926L18.8239 23.4762H29.9987L15.2743 7.42188Z"/></symbol>
            <symbol id="icon-finishing" viewBox="0 0 34 27" fill="currentColor"><path d="M33.4411 21.6254V17.6914H26.5567V18.6749C26.5567 21.3864 24.3507 22.6089 21.6392 22.6089H19.6722C17.5031 22.6089 15.7383 24.3736 15.7383 26.5428H33.4411V23.5924H27.5402V21.6254H33.4411Z"/><path d="M21.6378 20.6419C23.2647 20.6419 24.5882 20.3019 24.5882 18.6749V17.6914H0.000976562V20.6419H8.85239V22.6089H0.000976562V26.5428H13.7698C13.7698 23.289 16.417 20.6419 19.6708 20.6419H21.6378ZM12.7864 22.6089H10.8194V20.6419H12.7864V22.6089Z"/><path d="M27.5394 1.95454C27.4427 -0.652497 23.7013 -0.65053 23.6055 1.95454V5.8885H27.5394V1.95454Z"/><path d="M26.5556 15.7234C28.7283 15.7234 30.4896 13.9621 30.4896 11.7894V7.85547H20.6547V11.7894C20.6547 13.9621 18.8934 15.7234 16.7207 15.7234H26.5556Z"/></symbol>
            
            <!-- Alert Icons -->
            <symbol id="icon-check" viewBox="0 0 24 24" stroke-width="3" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                <path d="M5 12l5 5l10 -10"/>
            </symbol>
            <symbol id="icon-alertTriangle" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                <path d="M12 9v2m0 4v.01"/>
                <path d="M5 19h14a2 2 0 0 0 1.84 -2.75L13.74 4a2 2 0 0 0 -3.5 0l-7.1 12.25a2 2 0 0 0 1.75 2.75z"/>
            </symbol>
            <symbol id="icon-xCircle" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                <path d="M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0"/>
                <path d="M10 10l4 4m0 -4l-4 4"/>
            </symbol>

        </defs>
    </svg>

    <div class="pdf-container">
        {% set text_data = details %}
        {% set locale = locale %}
        
        {# Title rendering removed - PDF will not show the title #}
        
        {% macro render_icon_svg_macro(icon_name_str, default_icon_for_type=None, css_class="", depth=0) %}
            {% set final_icon_name = icon_name_str %}

            {% if default_icon_for_type == 'ul' or default_icon_for_type == 'ul-nested' %}
                {% if icon_name_str == 'none' %}
                    {% set final_icon_name = 'none' %}
                {% elif icon_name_str %}
                    {% set final_icon_name = icon_name_str %}
                {% else %}
                    {% set final_icon_name = 'new-bullet' %}
                {% endif %}
            {% elif not icon_name_str %}
                {% if default_icon_for_type == 'alert-info' %}{% set final_icon_name = 'info' %} 
                {% elif default_icon_for_type == 'alert-success' %}{% set final_icon_name = 'check' %} 
                {% elif default_icon_for_type == 'alert-warning' %}{% set final_icon_name = 'alertTriangle' %} 
                {% elif default_icon_for_type == 'alert-danger' %}{% set final_icon_name = 'xCircle' %} 
                {% endif %}
            {% elif icon_name_str %}
                 {% set final_icon_name = icon_name_str %}
            {% endif %}

            {% if final_icon_name and final_icon_name != 'none' %}
                <svg class="icon-svg {{ css_class }} icon-{{final_icon_name}}"><use xlink:href="#icon-{{ final_icon_name }}" /></svg>
            {% endif %}
        {% endmacro %}

        {% macro render_list_items_recursive_macro(items_list, list_type_str, list_icon_name_str, depth, is_in_mini_section=false) %}
            {% if items_list is iterable and items_list is not string and items_list|length > 0 %}
                {% for item_content in items_list %}
                    <li>
                        {% if list_type_str == 'numbered_list' %}
                            <span class="list-number-circle">{{ loop.index }}</span>
                            <div class="list-content-column">
                                {% if item_content is mapping %}
                                    {{ render_single_block_recursive_macro(item_content, depth + 1, is_in_mini_section) }}
                                {% elif item_content is string %}
                                    <span>{% set segments = item_content.split('**') %}{% for segment in segments %}{% if loop.index0 is odd %}<span style="font-weight: var(--font-weight-medium); color: var(--color-text-black);">{{ segment }}</span>{% else %}{{ segment }}{% endif %}{% endfor %}</span>
                                {% elif item_content is iterable %}
                                    {% for block in item_content %}
                                        {{ render_single_block_recursive_macro(block, depth + 1, is_in_mini_section) }}
                                    {% endfor %}
                                {% else %}
                                    <span class="error-message">Numbered list item content is not string, dict, or list.</span>
                                {% endif %}
                            </div>
                        {% else %} {# bullet_list logic #}
                            <div class="list-marker">
                                {{ render_icon_svg_macro(list_icon_name_str, 'ul' if depth == 0 else 'ul-nested', 'bullet-icon', depth) }}
                            </div>
                            <div class="list-item-text-or-block">
                            {% if item_content is string %}
                                <span>{% set segments = item_content.split('**') %}{% for segment in segments %}{% if loop.index0 is odd %}<span style="font-weight: var(--font-weight-medium); color: var(--color-text-black);">{{ segment }}</span>{% else %}{{ segment }}{% endif %}{% endfor %}</span>
                            {% elif item_content is mapping %}
                                {{ render_single_block_recursive_macro(item_content, depth + 1, is_in_mini_section) }}
                            {% elif item_content is iterable %}
                                {% for block in item_content %}
                                    {{ render_single_block_recursive_macro(block, depth + 1, is_in_mini_section) }}
                                {% endfor %}
                            {% else %}
                                <span class="error-message">Item is not string, dict, or list: {{ item_content }}</span>
                            {% endif %}
                            </div>
                        {% endif %}
                    </li>
                {% endfor %}
            {% elif items_list is none or (items_list is iterable and items_list|length == 0) %}
            {% else %}
                <li class="error-message">Items list for "{{list_type_str}}" is not iterable. Type: {{ items_list|type }}</li>
            {% endif %}
        {% endmacro %}

        {% macro render_single_block_recursive_macro(block_data, depth=0, is_in_mini_section=false) %}
            {% if block_data is mapping %}
                {% set block_type = block_data.get('type') %}
                {% set level = block_data.level | default(3) %}
                {% set text_content = block_data.text | default('') %}
                {% set alert_title_content = block_data.title | default('') %}

                <div class="content-block-wrapper type-{{block_type}}"{% if block_type == 'image' and block_data.get('layoutMode') in ['inline-left', 'inline-right'] %} style="margin-bottom: 0;"{% endif %}>
                    {% if block_type == 'headline' %}
                        {% set is_recommendation_headline = text_content.lower().startswith('recommendation:') %}
                        {% set headline_font_size = block_data.fontSize if block_data.fontSize else (level == 1 or level == 2) and '1.25rem' or level == 3 and '1.125rem' or level == 4 and '1rem' or '1.25rem' %}
                        {% set headline_color = block_data.textColor if block_data.textColor else (is_recommendation_headline and '#0F58F9') or ((level == 1 or level == 2) and '#171718') or ((level == 3 or level == 4) and '#0F58F9') or '#171718' %}
                        {% set headline_weight = (level == 1 or level == 4) and '700' or level == 2 and '600' or level == 3 and '500' or '700' %}
                        <div class="headline-block h{{ level }}"
                             style="{% if block_data.backgroundColor %}background-color: {{ block_data.backgroundColor }};{% endif %} color: {{ headline_color }}; fill: {{ headline_color }}; font-size: {{ headline_font_size }}; font-weight: {{ headline_weight }}; line-height: 1.3; margin-top: {% if level == 1 %}0{% elif level == 2 %}1.25rem{% else %}0.625rem{% endif %}; margin-bottom: {% if level == 1 %}0.5rem{% elif level == 2 %}0.75rem{% else %}0.375rem{% endif %}; {% if block_data.backgroundColor and block_data.backgroundColor != 'transparent' %}padding: 12px 16px; border-radius: 8px;{% endif %}">
                            {% if block_data.iconName %}{{ render_icon_svg_macro(block_data.iconName) }}{% endif %}
                            <span>{% set segments = text_content.split('**') %}{% for segment in segments %}{% if loop.index0 is odd %}<span style="font-weight: 600; color: #0F58F9;">{{ segment }}</span>{% else %}{{ segment }}{% endif %}{% endfor %}</span>
                        </div>
                    {% elif block_type == 'table' %}
                        <div class="table-block-wrapper" style="overflow-x:auto; margin: 16px 0;">
                          <table style="border-collapse:collapse; width:100%; font-size:13px; border-radius: 8px; overflow: hidden; font-family: var(--font-primary);">
                            {% if block_data.caption %}
                                                              <caption style="caption-side:bottom; text-align:left; color:#888; font-size:11px; padding:4px 0; font-family: var(--font-primary);">{{ block_data.caption }}</caption>
                            {% endif %}
                            <thead>
                              <tr>
                                {% for header in block_data.headers %}
                                  <th style="border:1px solid #E5E7EB; background:#232B3A; color:#FFF; padding:16px 24px; font-weight:600; text-align:left; vertical-align:middle; font-family: var(--font-primary);">{% set segments = header.split('**') %}{% for segment in segments %}{% if loop.index0 is odd %}<span style="font-weight: bold; color: #FFF;">{{ segment }}</span>{% else %}{{ segment }}{% endif %}{% endfor %}</th>
                                {% endfor %}
                              </tr>
                            </thead>
                            <tbody>
                              {% for row in block_data.rows %}
                                <tr style="background-color: {% if loop.index0 % 2 == 0 %}#FFFFFF{% else %}#F7F8FA{% endif %};">
                                  {% for cell in row %}
                                    <td style="border:1px solid #E5E7EB; padding:16px 24px; vertical-align:middle; color:#000000; font-family: var(--font-primary);">
                  {% set segments = cell.split('**') %}
                  {% for segment in segments %}
                    {% if loop.index0 is odd %}<span style="font-weight: bold;">{{ segment }}</span>{% else %}{{ segment }}{% endif %}
                  {% endfor %}
                </td>
              {% endfor %}
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
{% elif block_type == 'paragraph' %}
    <p class="paragraph-block {{ 'recommendation' if block_data.isRecommendation else '' }}" style="font-size: {{ block_data.fontSize if block_data.fontSize else '1rem' }}; font-weight: 300; line-height: 1.5; color: #4B5563; margin-bottom: 1rem; text-align: left; {% if block_data.isRecommendation %}padding-left: 1rem; border-left: 4px solid #0F58F9; padding-top: 0.5rem; padding-bottom: 0.5rem; background-color: rgba(243, 244, 246, 0.3);{% endif %}">{% set segments = text_content.split('**') %}{% for segment in segments %}{% if loop.index0 is odd %}<span style="font-weight: 600; color: #0F58F9;">{{ segment }}</span>{% else %}{{ segment }}{% endif %}{% endfor %}</p>
{% elif block_type == 'bullet_list' or block_type == 'numbered_list' %}
    {% set has_recommendation = false %}
    {% if block_type == 'bullet_list' and block_data.get('items') is iterable and block_data.get('items') is not string %}
        {% for item_content in block_data.get('items', []) %}
            {% if item_content is mapping and item_content.get('type') == 'paragraph' and item_content.get('isRecommendation') %}
                {% set has_recommendation = true %}
            {% endif %}
        {% endfor %}
    {% endif %}
    <div class="list-block-wrapper {{block_type}} depth-{{depth}} {% if has_recommendation %}has-recommendation{% endif %}" {% if block_data.fontSize %}style="font-size: {{ block_data.fontSize }};"{% endif %}>
        {% if block_type == 'bullet_list' %}
            <ul>{{ render_list_items_recursive_macro(block_data.get('items'), block_type, block_data.iconName, depth, is_in_mini_section) }}</ul>
        {% else %} {# numbered_list #}
            <ol>{{ render_list_items_recursive_macro(block_data.get('items'), block_type, None, depth, is_in_mini_section) }}</ol>
        {% endif %}
    </div>
{% elif block_type == 'alert' %}
   <div class="alert-block alert-{{ block_data.alertType | default('info') }}"
         style="{% if block_data.backgroundColor %}background-color: {{ block_data.backgroundColor }};{% endif %}{% if block_data.borderColor %}border-color: {{ block_data.borderColor }};{% endif %}{% if block_data.textColor %}color: {{ block_data.textColor }};{% endif %}{% if block_data.fontSize %}font-size: {{ block_data.fontSize }};{% endif %}">
        <div class="icon-container" style="{% if block_data.iconColor %}color: {{ block_data.iconColor }}; fill: {{ block_data.iconColor }};{% endif %}">
            {{ render_icon_svg_macro(block_data.iconName, 'alert-' + (block_data.alertType|default('info')) ) }}
        </div>
        <div class="text-container">
            {% if block_data.title %}<div class="alert-title">{% set segments = alert_title_content.split('**') %}{% for segment in segments %}{% if loop.index0 is odd %}<span style="font-weight: var(--font-weight-medium); color: var(--color-text-black);">{{ segment }}</span>{% else %}{{ segment }}{% endif %}{% endfor %}</div>{% endif %}
            <div class="alert-text">{% set segments = text_content.split('**') %}{% for segment in segments %}{% if loop.index0 is odd %}<span style="font-weight: var(--font-weight-medium); color: var(--color-text-black);">{{ segment }}</span>{% else %}{{ segment }}{% endif %}{% endfor %}</div>
        </div>
    </div>
{% elif block_type == 'section_break' %}
    {% if block_data.style == 'solid' or block_data.style == 'dashed' %}
        <hr class="section-break-block {{ block_data.style }}">
    {% elif block_data.style == 'none' %}
         <div class="section-break-block none"></div>
    {% endif %}
            {% elif block_type == 'image' %}
  <!-- DEBUG: Image block data -->
  <!-- block_data.alignment: {{ block_data.alignment }} -->
  <!-- block_data.float: {{ block_data.float }} -->
  <!-- block_data.layoutMode: {{ block_data.layoutMode }} -->
  <!-- block_data.layoutPartnerIndex: {{ block_data.layoutPartnerIndex }} -->
  <!-- block_data.layoutProportion: {{ block_data.layoutProportion }} -->
  <!-- block_data.maxWidth: {{ block_data.maxWidth }} -->
  <!-- block_data.width: {{ block_data.width }} -->
  <!-- block_data.height: {{ block_data.height }} -->
  <!-- block_data.borderRadius: {{ block_data.borderRadius }} -->
  <!-- block_data.src: {{ block_data.src[:50] }}... -->
  
  {% set image_src = block_data.src %}
  
  {# Build image style to exactly match React frontend #}
  {% set img_style = "" %}
  
  {# Layout-specific styling #}
  {% if block_data.layoutMode == 'inline-left' or block_data.layoutMode == 'inline-right' %}
    <!-- Inline layout - text wraps around image -->
    {% set float_direction = 'left' if block_data.layoutMode == 'inline-left' else 'right' %}
    {% set margin_direction = 'right' if block_data.layoutMode == 'inline-left' else 'left' %}
    {% set img_style = img_style + " float: " + float_direction + ";" %}
    {% if margin_direction == 'right' %}
      {% set img_style = img_style + " margin: 0 16px 16px 0;" %}
    {% else %}
      {% set img_style = img_style + " margin: 0 0 16px 16px;" %}
    {% endif %}
    {# Use maxWidth for inline images, default to 200px like React #}
    {% set img_style = img_style + " max-width: " + (block_data.maxWidth or '200px') + ";" %}
  {% elif block_data.float %}
    <!-- Legacy float support -->
    {% set img_style = img_style + " float: " + block_data.float + ";" %}
    {% if block_data.float == 'left' %}
      {% set img_style = img_style + " margin: 0 16px 16px 0;" %}
    {% else %}
      {% set img_style = img_style + " margin: 0 0 16px 16px;" %}
    {% endif %}
    {% set img_style = img_style + " max-width: " + (block_data.maxWidth or '200px') + ";" %}
  {% elif block_data.layoutMode in ['side-by-side-left', 'side-by-side-right'] %}
    <!-- Side-by-side layout - for PDF, treat as centered for now -->
    {% set img_style = img_style + " display: block; margin-left: auto; margin-right: auto;" %}
    {% set img_style = img_style + " max-width: " + (block_data.maxWidth or '100%') + ";" %}
  {% else %}
    <!-- Standalone layout - match React alignment logic -->
    {% if block_data.alignment == 'left' %}
      {% set img_style = img_style + " display: block; margin-left: 0; margin-right: auto;" %}
    {% elif block_data.alignment == 'right' %}
      {% set img_style = img_style + " display: block; margin-left: auto; margin-right: 0;" %}
    {% else %}
      {% set img_style = img_style + " display: block; margin-left: auto; margin-right: auto;" %}
    {% endif %}
    {% set img_style = img_style + " max-width: " + (block_data.maxWidth or '100%') + ";" %}
  {% endif %}
  
  {# Width - exact match to React: width: width || 'auto' #}
  {% if block_data.width %}
    {% set img_style = img_style + " width: " + block_data.width|string %}
    {% if block_data.width is number %}
      {% set img_style = img_style + "px" %}
    {% endif %}
    {% set img_style = img_style + ";" %}
  {% else %}
    {% set img_style = img_style + " width: auto;" %}
  {% endif %}
  
  {# Height - exact match to React: height: height || 'auto' #}
  {% if block_data.height %}
    {% set img_style = img_style + " height: " + block_data.height|string %}
    {% if block_data.height is number %}
      {% set img_style = img_style + "px" %}
    {% endif %}
    {% set img_style = img_style + ";" %}
  {% else %}
    {% set img_style = img_style + " height: auto;" %}
  {% endif %}
  
  {# Additional styling to match React #}
  {% set img_style = img_style + " border-radius: " + (block_data.borderRadius or '8px') + ";" %}
  {% set img_style = img_style + " box-shadow: " + (block_data.boxShadow or '0 2px 4px rgba(0,0,0,0.1)') + ";" %}
  {% set img_style = img_style + " border: " + (block_data.border or 'none') + ";" %}
  {% set img_style = img_style + " opacity: " + (block_data.opacity or 1)|string + ";" %}
  {% set img_style = img_style + " transform: " + (block_data.transform or 'none') + ";" %}
  
  <img src="{{ image_src }}" 
       alt="{{ block_data.alt or 'Image' }}" 
       style="{{ img_style }}" 
       onerror="this.style.display='none'; this.nextElementSibling.style.display='block';" />
  <div style="display: none; padding: 20px; border: 2px dashed #ccc; text-align: center; color: #666; font-style: italic;">
    {{ block_data.alt or 'Image not available' }}
  </div>
  {% if block_data.caption %}
    <p style="font-size: 10px; color: #666; text-align: {{ block_data.alignment or 'center' }}; margin: 8px 0 0 0; font-style: italic; font-family: var(--font-primary);">
      {% set segments = block_data.caption.split('**') %}
      {% for segment in segments %}
        {% if loop.index0 is odd %}<span style="font-weight: bold;">{{ segment }}</span>{% else %}{{ segment }}{% endif %}
      {% endfor %}
    </p>
  {% endif %}
{% elif block_type == 'column_container' %}
    <div class="column-container-block" style="display: grid; grid-template-columns: repeat({{ block_data.columnCount or 2 }}, 1fr); gap: 24px; margin: 16px 0;">
        {% if block_data.columns is iterable and block_data.columns is not string %}
            {% for column in block_data.columns %}
                <div style="display: flex; flex-direction: column; gap: 8px;">
                    {% if column is iterable and column is not string %}
                        {% for col_block in column %}
                            {{ render_single_block_recursive_macro(col_block, depth, is_in_mini_section) }}
                        {% endfor %}
                    {% endif %}
                </div>
            {% endfor %}
        {% endif %}
    </div>
{% elif block_type == 'purple_box' %}
    {% set purple_cards = block_data.cards if block_data.cards else [] %}
    {% if purple_cards %}
        {% set grid_columns = purple_cards|length %}
        <div class="column-container-block" style="display: grid; grid-template-columns: repeat({{ grid_columns if grid_columns <= 4 else 4 }}, 1fr); gap: 16px; margin: 16px 0;">
            {% if block_data.title %}
                <div style="grid-column: 1 / -1;">
                    <h3 style="font-size: 18px; font-weight: 600; color: #171718; margin: 0;">{{ block_data.title }}</h3>
                </div>
            {% endif %}
            {% if block_data.description %}
                <div style="grid-column: 1 / -1;">
                    <p style="font-size: 14px; color: #4B5563; line-height: 1.5; margin: 0;">{{ block_data.description }}</p>
                </div>
            {% endif %}
            {% for card in purple_cards %}
                <div style="background-color: #CCDBFCCC; border: 1px solid #CCCCCC; border-radius: 8px; padding: 20px; display:flex; flex-direction:column; gap:8px;">
                    <div style="display:flex; align-items:center; gap:12px;">
                        {% if card.icon %}
                            <span class="purple-card-icon-wrapper">
                                {{ render_icon_svg_macro(card.icon) }}
                            </span>
                        {% endif %}
                        <h3 style="font-weight: 600; color: #171718; font-size: 16px; margin:0;">{{ card.title }}</h3>
                    </div>
                    <p style="font-size: 14px; color: #4B5563; line-height: 1.5; margin:0;">{{ card.description }}</p>
                </div>
            {% endfor %}
        </div>
  {% endif %}
{% else %}
    <p class="error-message">Unsupported block type: {{ block_type }}</p>
{% endif %}
</div>
{% else %}
    <p class="error-message">Block data is not a dictionary/mapping: {{ block_data }}</p>
{% endif %}
{% endmacro %}

<div class="pdf-container">
  <div class="content-wrapper">
    {% if text_data.textTitle %}
      <header class="main-title-section" style="background-color: #FFFFFF; border-bottom: 1px solid #CCCCCC; padding: 16px 40px;">
        <h1 class="main-title-text" style="font-size: 1.5rem; font-weight: 700; color: #0F58F9; padding: 16px 0; margin: 0; text-align: left;">
          {% set segments = text_data.textTitle.split('**') %}
          {% for segment in segments %}
            {% if loop.index0 is odd %}<strong>{{ segment }}</strong>{% else %}{{ segment }}{% endif %}
          {% endfor %}
        </h1>
      </header>
    {% endif %}
    <div style="background-color: #FFFFFF; padding: 16px 32px;">
    {% if text_data.purpleBoxContent and text_data.purpleBoxContent.cards and text_data.purpleBoxContent.cards|length > 0 %}
      <div class="purple-box-section" style="margin: 16px 0; display: flex; flex-direction: column; gap: 16px;">
        {% if text_data.purpleBoxContent.title %}
          <h2 style="font-size: 18px; font-weight: 600; color: #171718; margin: 0;">{{ text_data.purpleBoxContent.title }}</h2>
        {% endif %}
        {% if text_data.purpleBoxContent.description %}
          <p style="font-size: 14px; color: #4B5563; line-height: 1.5; margin: 0;">{{ text_data.purpleBoxContent.description }}</p>
        {% endif %}
        <div style="display: grid; grid-template-columns: repeat({{ text_data.purpleBoxContent.cards|length if text_data.purpleBoxContent.cards|length <= 4 else 4 }}, 1fr); gap: 16px;">
          {% for card in text_data.purpleBoxContent.cards %}
            <div style="background-color: #CCDBFCCC; border: 1px solid #CCCCCC; border-radius: 8px; padding: 20px; display:flex; flex-direction:column; gap:8px;">
              <div style="display:flex; align-items:center; gap:12px;">
                {% if card.icon %}
                  <span class="purple-card-icon-wrapper">
                    {{ render_icon_svg_macro(card.icon) }}
                  </span>
                {% endif %}
                <h3 style="font-weight: 600; color: #171718; font-size: 16px; margin:0;">{{ card.title }}</h3>
              </div>
              <p style="font-size: 14px; color: #4B5563; line-height: 1.5; margin:0;">{{ card.description }}</p>
            </div>
          {% endfor %}
        </div>
      </div>
    {% endif %}
    {% if text_data is mapping and text_data.contentBlocks is iterable and text_data.contentBlocks is not string %}
        {% set blocks_to_render = text_data.contentBlocks %}
        {% if text_data.textTitle and blocks_to_render and blocks_to_render[0].type == 'headline' and blocks_to_render[0].level in [1, 2] and blocks_to_render[0].text | trim | lower == text_data.textTitle | trim | lower %}
            {% set blocks_to_render = blocks_to_render[1:] %}
        {% endif %}

        {% set next_block_in_box_content = [false] %}
        {% set skip_next_block = [false] %}
        {% for loop_index in range(blocks_to_render | length) %}
            {% set current_block_item = blocks_to_render[loop_index] %}
            {% set next_block_item = blocks_to_render[loop_index+1] if (loop_index+1) < (blocks_to_render | length) else none %}
            {% set is_last_block_overall = loop_index == (blocks_to_render | length) - 1 %}
            
            {% if skip_next_block[0] %}
                {% set _ = skip_next_block.pop() %}{% set _ = skip_next_block.append(false) %}
            {% elif next_block_in_box_content[0] %}
                {% set _ = next_block_in_box_content.pop() %}{% set _ = next_block_in_box_content.append(false) %}
            {% else %}
                {% set is_important_headline_check = current_block_item is mapping and current_block_item.get('type') == 'headline' and current_block_item.get('isImportant') %}
                {% set is_relevant_content_following_for_box_check = next_block_item is mapping and next_block_item.get('type') in ['bullet_list', 'numbered_list', 'paragraph', 'alert'] %}
                
                {# Check for inline image layout #}
                {% set is_inline_image = current_block_item is mapping and current_block_item.get('type') == 'image' and current_block_item.get('layoutMode') in ['inline-left', 'inline-right'] %}
                {% set has_wrapping_content = next_block_item is mapping and next_block_item.get('type') in ['paragraph', 'bullet_list', 'numbered_list'] %}
                
                {% if is_inline_image and has_wrapping_content %}
                    {# Render inline image with wrapping content #}
                    <div class="content-block-wrapper inline-layout-container" style="overflow: hidden; margin-bottom: calc(var(--space-sm) * var(--dynamic-spacing-multiplier));">
                        {{ render_single_block_recursive_macro(current_block_item, 0) }}
                        {{ render_single_block_recursive_macro(next_block_item, 0) }}
                        <div style="clear: both;"></div>
                    </div>
                    {% set _ = skip_next_block.pop() %}{% set _ = skip_next_block.append(true) %}
                {% elif is_important_headline_check %} 
                    <div class="mini-section-box-wrapper"> <div class="mini-section-box">
                        {{ render_single_block_recursive_macro(current_block_item, 0, is_in_mini_section=true) }}
                        {% if is_relevant_content_following_for_box_check %}
                            {{ render_single_block_recursive_macro(next_block_item, 0, is_in_mini_section=true) }}
                            {% set _ = next_block_in_box_content.pop() %}{% set _ = next_block_in_box_content.append(true) %}
                        {% endif %}
                    </div> </div>
                {% else %} 
                    {{ render_single_block_recursive_macro(current_block_item, 0) }}
                {% endif %}
            {% endif %}

        {% endfor %}
    {% elif text_data and text_data.contentBlocks is not none %}
         <p class="error-message">contentBlocks is not iterable. Type: {{ text_data.contentBlocks|type }}</p>
    {% else %}
         <p class="warning-message">No content blocks found.</p>
    {% endif %}
    </div>
  </div>
</div>

<script>
// Dynamic spacing adjustment based on page content
function adjustPageSpacing() {
    const contentWrapper = document.querySelector('.content-wrapper');
    if (!contentWrapper) return;
    
    // Get the total height of content
    const contentHeight = contentWrapper.scrollHeight;
    const containerHeight = contentWrapper.clientHeight;
    const availableSpace = containerHeight;
    const usedSpace = contentHeight;
    const emptySpace = availableSpace - usedSpace;
    const fillPercentage = (usedSpace / availableSpace) * 100;
    
    // Remove existing spacing classes
    contentWrapper.classList.remove('spacing-compact', 'spacing-normal', 'spacing-expanded', 'spacing-very-expanded');
    
    // Apply spacing based on fill percentage
    if (fillPercentage < 60) {
        // Very empty page - use maximum spacing
        contentWrapper.classList.add('spacing-very-expanded');
    } else if (fillPercentage < 75) {
        // Somewhat empty - use expanded spacing
        contentWrapper.classList.add('spacing-expanded');
    } else if (fillPercentage > 95) {
        // Very full page - use compact spacing
        contentWrapper.classList.add('spacing-compact');
    } else {
        // Normal fill - use standard spacing
        contentWrapper.classList.add('spacing-normal');
    }
}

// Run adjustment when page loads and after any dynamic content changes
document.addEventListener('DOMContentLoaded', adjustPageSpacing);
window.addEventListener('load', adjustPageSpacing);

// For PDF generation, also run after a short delay to ensure all content is rendered
setTimeout(adjustPageSpacing, 100);
setTimeout(adjustPageSpacing, 500);
</script>

</body>
</html> 