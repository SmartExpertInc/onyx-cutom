# PIE CHART - РУКОВОДСТВО ПО ТЕСТИРОВАНИЮ ИСПРАВЛЕНИЙ

## Обзор исправлений

Исправления позиционирования процентов в pie chart были применены в следующих файлах:

1. `backend/app/services/pie_chart_generator.py` - основной генератор изображений
2. `backend/app/utils/pie_chart_calculator.py` - утилита для расчета позиций

## Ключевые изменения

### 1. Исправлен радиус позиционирования
- **Было**: 105px
- **Стало**: 98px (точно как во фронтенде)

### 2. Исправлен размер шрифта
- **Было**: 20px
- **Стало**: 18px (точно как во фронтенде)

### 3. Добавлено адаптивное позиционирование
- Для сегментов < 30°: радиус 85px (ближе к центру)
- Для сегментов ≥ 30°: радиус 98px (как во фронтенде)

## Тестовые скрипты

### 1. Быстрый тест позиционирования
```bash
cd onyx-cutom/custom_extensions/backend
python quick_test.py
```

### 2. Полный тест генератора
```bash
cd onyx-cutom/custom_extensions/backend
python debug_pie_chart.py
```

### 3. Тест с реальными данными
```bash
cd onyx-cutom/custom_extensions/backend
python test_pie_chart_real_data.py
```

## Ожидаемые результаты

### Позиции процентов для данных из изображения (7 сегментов, 120%):

1. **8%** (24°): радиус 85px - ближе к центру
2. **15%** (45°): радиус 98px - стандартный
3. **20%** (60°): радиус 98px - стандартный
4. **20%** (60°): радиус 98px - стандартный
5. **25%** (75°): радиус 98px - стандартный
6. **20%** (60°): радиус 98px - стандартный
7. **12%** (36°): радиус 98px - стандартный

## Проверка в PDF

1. Создайте слайд с типом `pie-chart-infographics`
2. Добавьте данные сегментов с разными процентами
3. Экспортируйте в PDF
4. Убедитесь, что проценты находятся точно в центре своих сегментов

## Возможные проблемы

### Если изменения не применились:

1. **Перезапустите сервер** - изменения могут быть кэшированы
2. **Проверьте файлы** - убедитесь, что изменения сохранились
3. **Запустите тесты** - используйте тестовые скрипты для проверки

### Если позиции все еще неправильные:

1. **Проверьте логи** - посмотрите на ошибки в консоли
2. **Сравните с фронтендом** - убедитесь, что данные одинаковые
3. **Проверьте размеры сегментов** - маленькие сегменты должны использовать радиус 85px

## Файлы для проверки

- `backend/app/services/pie_chart_generator.py` - основной генератор
- `backend/app/utils/pie_chart_calculator.py` - утилита расчета позиций
- `backend/quick_test.py` - быстрый тест
- `backend/debug_pie_chart.py` - полный тест
- `backend/test_pie_chart_real_data.py` - тест с реальными данными

## Контакты

Если проблемы остаются, проверьте:
1. Версию кода в файлах
2. Логи сервера
3. Результаты тестовых скриптов 